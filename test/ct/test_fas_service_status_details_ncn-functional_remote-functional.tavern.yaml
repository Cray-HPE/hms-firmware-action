# Copyright 2020 Hewlett Packard Enterprise Development LP

# Tavern test cases for the FAS service status details API
# Author: Mitch Schooler
# Service: Firmware Action Service

# HMS test metrics test cases: 2
# 1. GET /service/status/details API response code
# 2. GET /service/status/details API response body
---
test_name: Verify the service status details resource

stages:
  # 1. GET /service/status/details API response code
  # 2. GET /service/status/details API response body
  - name: Ensure that the FAS service status details can be retrieved
    request:
      url: "{base_url}/fas/v1/service/status/details"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200
      verify_response_with:
        function: tavern.testutils.helpers:validate_pykwalify
        extra_kwargs:
          schema:
            type: map
            required: True
            mapping:
              serviceVersion:
                type: str
                required: True
                pattern: "[0-9]+.[0-9]+.[0-9]+"
              serviceStatus:
                type: str
                required: True
                enum:
                  - "running"
              hsmStatus:
                type: str
                required: True
                enum:
                  - "connected"
              storageStatus:
                type: str
                required: True
                enum:
                  - "connected"
